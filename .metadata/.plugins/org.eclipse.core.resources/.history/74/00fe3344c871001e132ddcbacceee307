package proyecto;

import javax.swing.JLabel;

import java.time.LocalDate;

import java.util.List;

import javax.swing.JComboBox;
import javax.swing.JSlider;
import javax.swing.JTextField;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

import proyecto.modelo.Fecha;
import proyecto.modelo.Registro;
import proyecto.modelo.Usuario;

import javax.swing.JButton;
import java.awt.event.ActionListener;
import java.math.BigDecimal;
import java.awt.event.ActionEvent;

public class NuevoRegistroView extends View {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private JTextField textFieldTareas;
	private JLabel lblHorasSliders;

	public NuevoRegistroView(App appController, Usuario usuario) {

		super(appController);

		setLayout(null);

		JLabel lblFecha = new JLabel("Fecha:");
		lblFecha.setBounds(133, 96, 46, 14);
		add(lblFecha);

		JComboBox<LocalDate> comboBoxFecha = new JComboBox<LocalDate>();
		comboBoxFecha.setBounds(133, 121, 185, 22);
		List<Fecha> fechas = null;
		fechas = appController.registroFechas();
		for (Fecha fecha : fechas) {
			comboBoxFecha.addItem(fecha.getFecha());
		}

		add(comboBoxFecha);

		JLabel lblHoras = new JLabel("Horas:");
		lblHoras.setBounds(133, 154, 46, 14);
		add(lblHoras);

		JSlider sliderHoras = new JSlider(0, 100, 0);
		sliderHoras.setBounds(133, 179, 245, 50);
		sliderHoras.setMinorTickSpacing(5);
		sliderHoras.setPaintTicks(true);
		sliderHoras.setPaintLabels(true);
		sliderHoras.setSnapToTicks(true);
		sliderHoras.addChangeListener(new ChangeListener() {
			public void stateChanged(ChangeEvent e) {
				lblHorasSliders.setText(String.valueOf(sliderHoras.getValue()/10));

			}
		});
		add(sliderHoras);

		JLabel lblTareas = new JLabel("Tareas Realizadas:");
		lblTareas.setBounds(136, 240, 135, 22);
		add(lblTareas);

		textFieldTareas = new JTextField();
		textFieldTareas.setBounds(136, 277, 360, 166);
		add(textFieldTareas);
		textFieldTareas.setColumns(10);

		JButton btnAceptar = new JButton("ACEPTAR");
		btnAceptar.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {

				Registro registro = new Registro();
				registro.setIdUsuario(appController.getUsuarioConectado().getIdUsuario());
				registro.setFecha((LocalDate) comboBoxFecha.getSelectedItem());
				registro.setNumHoras(new BigDecimal(sliderHoras.getValue()));
				registro.setDescripcion(textFieldTareas.getText());
				
				
				

				appController.crearRegistro(registro);

			}
		});
		btnAceptar.setBounds(432, 501, 89, 23);
		add(btnAceptar);

		JButton btnCancelar = new JButton("CANCELAR");
		btnCancelar.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				appController.irAPantallaBienvenida();
			}
		});
		btnCancelar.setBounds(541, 501, 109, 23);
		add(btnCancelar);

		lblHorasSliders = new JLabel("0");
		lblHorasSliders.setBounds(385, 194, 46, 14);

		add(lblHorasSliders);
		
	}

}